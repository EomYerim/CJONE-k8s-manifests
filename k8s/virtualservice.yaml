apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: spring-app
  namespace: default
spec:
  # Gateway와 VirtualService를 명확하게 연결하기 위해 hosts 필드를 통일합니다.
  # Gateway가 모든 호스트("")를 받으므로, 여기서도 모든 호스트("*")를 지정합니다.
  hosts:
    - "*"
  gateways:
    - spring-app-gateway # kubectl get gateway로 확인한 이름
  http:
    # --- 1. AI 포인트 적립 경로 (장애 시나리오) ---
    - match:
        - uri:
            prefix: "/api/v1/points/accumulate-ai"
      route:
        - destination:
            host: spring-app
            port:
              # [수정됨] Service가 리스닝하는 포트인 80으로 변경합니다.
              number: 80
      timeout: 0.5s

    # --- 2. 일반 포인트 적립 및 기타 경로 (정상) ---
    - match:
        - uri:
            prefix: "/"
      route:
        - destination:
            host: spring-app
            port:
              # [수정됨] Service가 리스닝하는 포트인 80으로 변경합니다.
              number: 80
